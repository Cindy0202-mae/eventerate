<div class="container">
  <h1>Preview Event Plan</h1>

  <h2><%= @event.title %></h2>
  <p><strong>Date: </strong><%= @event.date %></p>
  <p><strong>Duration: </strong><%= @event.duration %>minutes</p>

  <h3>Here are the activity suggestions</h3>
  <% if @generated_activities.present? %>
    <% @generated_activities.each do |activity| %>
      <div class="card mb-3 activity-preview">
        <div class="card-body">
          <h4 class="card-title"><%= activity.title %></h4>
          <%# Split the description into parts %>
          <% description_parts = activity.description.split("\n\n") %>
          <%# Remove the label prefixes using sub %>
          <% main_description = description_parts[0].sub(/\*\*Description\*\*:\s*/, '') %>
          <% instructions = description_parts[1].to_s.sub(/\*\*Step-by-Step Instructions\*\*:\s*/, '') %>
          <% materials = description_parts[2].to_s.sub(/\*\*Materials\*\*:\s*/, '') %>

          <p><%= main_description %></p>
          <p><strong>Step-by-Step Instructions:</strong></p>
          <% instructions.split("\n").each do |step| %>
            <p><%= step %></p>
          <% end %>
          <p><strong>Materials:</strong> <%= materials %></p>
          <p><strong>Genres:</strong> <%= activity.genres.join(', ') %></p>
          <p><strong>Age Range:</strong> <%= activity.age %></p>
        </div>
      </div>
    <% end %>
  <% else %>
    <p>No activities were generated. Please try again.</p>
  <% end %>

  <%= form_with url: save_event_plan_event_path(@event), method: :post do %>
    <%= hidden_field_tag :event_id, @event.id %>
    <%= submit_tag 'Save Event Plan', class: 'btn btn-primary' %>
  <% end %>
  <%= link_to 'Discard Event Plan', new_event_path, class: 'btn btn-secondary' %>
</div>
